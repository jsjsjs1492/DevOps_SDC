# dev-community/nginx/default.conf
server {
    listen 80; # Nginx 컨테이너가 들을 포트 (Dockerfile의 EXPOSE 80과 연결)
    server_name localhost; # 개발용

    # 프론트엔드 정적 파일 서빙
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html; # React SPA 라우팅을 위한 설정
    }

    # 백엔드 API 요청 프록시
    # 모든 /api/v1/ 요청은 백엔드 컨테이너의 8081 포트로 전달
    # Spring Boot 앱의 실제 API 경로에 따라 /api/v1/ 대신 /auth, /post 등으로 변경 가능
    # 현재 코드에서는 /auth, /post 등으로 바로 시작하므로 / 대신 해당 경로를 포함하는 것이 더 정확합니다.
    location /auth/ {
        proxy_pass http://backend:8081/auth/; # backend는 Docker Compose 서비스 이름
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /post/ {
        proxy_pass http://backend:8081/post/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /member/ {
        proxy_pass http://backend:8081/member/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /comment/ {
        proxy_pass http://backend:8081/comment/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 다른 API 경로가 있다면 여기에 추가 (예: /tags/, /search/ 등)
    # location /your-other-api-path/ {
    #     proxy_pass http://backend:8081/your-other-api-path/;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # 에러 로그 설정 (선택 사항)
    error_log /var/log/nginx/error.log warn;
    access_log /var/log/nginx/access.log main;
}
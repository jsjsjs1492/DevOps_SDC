# ----------- 1단계: React 앱 빌드(Stage 1) -----------
FROM node:20 as builder                  
# 1단계: Node.js 20 이미지를 기반으로 빌드 컨테이너 생성
WORKDIR /app                            
 # 작업 디렉토리를 /app으로 설정
COPY . .                                 
# 현재 디렉토리(소스코드 전체)를 컨테이너의 /app에 복사
RUN npm install && npm run build         
# 의존성 설치 후, React 앱을 프로덕션 빌드(/app/build 폴더 생성)
    
# ----------- 2단계: Nginx로 정적 파일 서빙(Stage 2) -----------
FROM nginx:alpine                         
# 2단계: 경량 Nginx 이미지를 기반으로 새 컨테이너 생성
COPY --from=builder /app/build /usr/share/nginx/html   
# 1단계에서 빌드된 정적 파일을 Nginx의 기본 웹 루트로 복사
COPY nginx/default.conf /etc/nginx/conf.d/default.conf 
# 커스텀 Nginx 설정 파일을 컨테이너에 복사
EXPOSE 80                                
# 컨테이너의 80번 포트를 외부에 노출 (HTTP 서비스용)
CMD ["nginx", "-g", "daemon off;"]       
# Nginx를 포그라운드(daemon off)로 실행 (컨테이너가 계속 동작하도록)
    